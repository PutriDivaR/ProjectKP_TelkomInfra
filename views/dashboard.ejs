<%- include('layout/header') %>
<%- include('layout/sidebar') %>

<div class="main">
  <!-- HEADER -->
  <div class="header">
    <div>
      <h1>üìä Dashboard Monitoring RIDAR</h1>
      <p>Real-time monitoring work order dan kendala teknis</p>
    </div>
    <div>
      <button class="btn-refresh" id="refreshBtn">
        <span>üîÑ</span> Refresh Data
      </button>
    </div>
  </div>

  <!-- KPI SECTION -->
  <div class="kpi-section">
    <h2 class="section-title">üìà Key Performance Indicators</h2>
    <div class="kpi-grid">
      <div class="kpi-card info">
        <div class="kpi-label">Total Work Orders</div>
        <div class="kpi-value" id="totalWO">0</div>
        <div class="kpi-subtitle">Semua WO aktif</div>
      </div>

      <div class="kpi-card warning">
        <div class="kpi-label">On Progress</div>
        <div class="kpi-value" id="onProgressWO">0</div>
        <div class="kpi-subtitle">Sedang dikerjakan</div>
      </div>

      <div class="kpi-card success">
        <div class="kpi-label">Completed</div>
        <div class="kpi-value" id="completeWO">0</div>
        <div class="kpi-subtitle">Selesai hari ini</div>
      </div>

      <div class="kpi-card danger">
        <div class="kpi-label">Open / Pending</div>
        <div class="kpi-value" id="openWO">0</div>
        <div class="kpi-subtitle">Belum ditangani</div>
      </div>

      <div class="kpi-card info">
        <div class="kpi-label">Avg Completion Time</div>
        <div class="kpi-value" id="avgTime">-</div>
        <div class="kpi-subtitle">Rata-rata penyelesaian</div>
      </div>

      <div class="kpi-card success">
        <div class="kpi-label">Completion Rate</div>
        <div class="kpi-value" id="completionRate">0%</div>
        <div class="kpi-subtitle">Tingkat penyelesaian</div>
      </div>
    </div>
  </div>

  <!-- STO SUMMARY -->
  <div class="kpi-section">
    <h2 class="section-title">üó∫Ô∏è STO Summary</h2>
    <div class="regional-grid" id="regionalSummary">
      <!-- Will be populated by JavaScript -->
    </div>
  </div>

  <!-- WORK FULL PROCESS TABLE -->
  <div class="table-container">
    <div class="table-header">
      <h3 class="table-title">üìä Work Full Process</h3>
    </div>
    
    <div class="table-scroll">
      <table class="table-work-full">
        <thead>
          <tr>
            <th rowspan="2">STO</th>
            <th colspan="3">Work Fail</th>
            <th rowspan="2">Pending</th>
            <th rowspan="2">Continue</th>
            <th rowspan="2">Cancel</th>
            <th rowspan="2">Complete</th>
            <th rowspan="2">Total</th>
          </tr>
          <tr>
            <th>KDL PLG</th>
            <th>KDL TEK</th>
            <th>KDL SYS</th>
          </tr>
        </thead>
        <tbody id="workFullProcessBody">
          <tr><td colspan="9" style="text-align:center">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- FILTERS PER TABLE: WORK ORDERS -->
  <div class="filter-container">
    <h3 class="filter-title">ÔøΩ Filter Work Orders</h3>
    <div class="filter-grid">
      <div class="filter-group">
        <label>Regional</label>
        <select id="woFilterRegional" class="filter-select">
          <option value="">Semua Regional</option>
        </select>
      </div>
      <div class="filter-group">
        <label>STO</label>
        <select id="woFilterSTO" class="filter-select">
          <option value="">Semua STO</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Status (Daily)</label>
        <select id="woFilterStatus" class="filter-select">
          <option value="">Semua Status</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Package</label>
        <select id="woFilterPackage" class="filter-select">
          <option value="">Semua Package</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Start Date</label>
        <input type="date" id="woFilterStartDate" class="filter-input">
      </div>
      <div class="filter-group">
        <label>End Date</label>
        <input type="date" id="woFilterEndDate" class="filter-input">
      </div>
      <div class="filter-actions">
        <button class="btn-primary" id="applyWoFilter">Apply</button>
        <button class="btn-secondary" id="resetWoFilter">Reset</button>
        <button class="btn-secondary" id="exportExcel">üì• Export</button>
      </div>
    </div>
  </div>

  <!-- CHARTS SECTION -->
  <div class="chart-grid">
    <!-- Status Distribution -->
    <div class="chart-card">
      <div class="chart-title">
        <span class="chart-icon">üìä</span>
        <span>Status Distribution</span>
      </div>
      <div class="chart-wrapper">
        <canvas id="statusChart"></canvas>
      </div>
    </div>

    <!-- STO Performance -->
    <div class="chart-card">
      <div class="chart-title">
        <span class="chart-icon">üìç</span>
        <span>STO Performance</span>
      </div>
      <div class="chart-wrapper">
        <canvas id="stoChart"></canvas>
      </div>
    </div>

    <!-- Trend Chart - Full Width -->
    <div class="chart-card full-width">
      <div class="chart-title">
        <span class="chart-icon">üìà</span>
        <span>Work Order Trend (Last 30 Days)</span>
      </div>
      <div class="chart-wrapper tall">
        <canvas id="trendChart"></canvas>
      </div>
    </div>

    <!-- Package Distribution -->
    <div class="chart-card">
      <div class="chart-title">
        <span class="chart-icon">üì¶</span>
        <span>Package Distribution</span>
      </div>
      <div class="chart-wrapper">
        <canvas id="packageChart"></canvas>
      </div>
    </div>

    <!-- Completion Rate by STO -->
    <div class="chart-card">
      <div class="chart-title">
        <span class="chart-icon">‚úÖ</span>
        <span>Completion Rate by STO</span>
      </div>
      <div class="chart-wrapper">
        <canvas id="completionChart"></canvas>
      </div>
    </div>
  </div>

  <!-- WORK ORDERS TABLE -->
  <div class="table-container">
    <div class="table-header">
      <h3 class="table-title">üìã Work Orders</h3>
      <div class="table-search">
        <input type="text" id="searchWorkOrders" placeholder="Search..." class="search-input">
      </div>
    </div>

    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th>WO Number</th>
            <th>Customer</th>
            <th>Ticket ID</th>
            <th>Package</th>
            <th>STO</th>
            <th>Status</th>
            <th>ODP</th>
            <th>Created</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="workOrdersBody">
          <tr><td colspan="10" style="text-align:center">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <div class="table-pager">
      <button id="workOrdersPrev">Previous</button>
      <div class="page-numbers" id="workOrdersPages">
        <button class="page-btn active">1</button>
      </div>
      <button id="workOrdersNext">Next</button>
    </div>
  </div>

  <!-- KENDALA TEKNIS TABLE -->
  <div class="table-container">
    <div class="table-header">
      <h3 class="table-title">‚ö†Ô∏è Kendala Teknis & Sistem</h3>
      <div class="table-search">
        <input type="text" id="searchKendalaTeknisi" placeholder="Search..." class="search-input">
      </div>
    </div>

    <!-- FILTERS PER TABLE: KENDALA TEKNIS & SISTEM -->
    <div class="filter-grid" style="margin-bottom:10px">
      <div class="filter-group">
        <label>Status (Todolist)</label>
        <select id="ktFilterStatus" class="filter-select">
          <option value="">Semua Status</option>
        </select>
      </div>
      <div class="filter-group">
        <label>STO</label>
        <select id="ktFilterSTO" class="filter-select">
          <option value="">Semua STO</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Start Date</label>
        <input type="date" id="ktFilterStartDate" class="filter-input">
      </div>
      <div class="filter-group">
        <label>End Date</label>
        <input type="date" id="ktFilterEndDate" class="filter-input">
      </div>
      <div class="filter-actions">
        <button class="btn-primary" id="applyKtFilter">Apply</button>
        <button class="btn-secondary" id="resetKtFilter">Reset</button>
      </div>
    </div>

    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th>WO Number</th>
            <th>Unit</th>
            <th>Activity</th>
            <th>Status</th>
            <th>STO</th>
            <th>Segment</th>
            <th>Progress</th>
            <th>Solution</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody id="kendalaTeknisiBody">
          <tr><td colspan="9" style="text-align:center">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <div class="table-pager">
      <button id="kendalaTeknisiPrev">Previous</button>
      <div class="page-numbers" id="kendalaTeknisiPages">
        <button class="page-btn active">1</button>
      </div>
      <button id="kendalaTeknisiNext">Next</button>
    </div>
  </div>

  <!-- KENDALA PELANGGAN TABLE -->
  <div class="table-container">
    <div class="table-header">
      <h3 class="table-title">üë• Kendala Pelanggan</h3>
      <div class="table-search">
        <input type="text" id="searchKendalaPelanggan" placeholder="Search..." class="search-input">
      </div>
    </div>

    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th>WO Number</th>
            <th>Customer</th>
            <th>STO</th>
            <th>Tanggal Input</th>
            <th>TTD KB</th>
            <th>Status HI</th>
            <th>TTIC</th>
            <th>Keterangan</th>
            <th>Nama Teknis</th>
          </tr>
        </thead>
        <tbody id="kendalaPelangganBody">
          <tr><td colspan="10" style="text-align:center">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <div class="table-pager">
      <button id="kendalaPelangganPrev">Previous</button>
      <div class="page-numbers" id="kendalaPelangganPages">
        <button class="page-btn active">1</button>
      </div>
      <button id="kendalaPelangganNext">Next</button>
    </div>
  </div>

  <!-- WILAYAH TABLE -->
  <div class="table-container">
    <div class="table-header">
      <h3 class="table-title">üó∫Ô∏è Wilayah RIDAR</h3>
      <div class="table-search">
        <input type="text" id="searchWilayah" placeholder="Search..." class="search-input">
      </div>
    </div>

    <div class="table-scroll">
      <table class="table-compact">
        <thead>
          <tr>
            <th>STO</th>
            <th>UIC</th>
            <th>PIC</th>
            <th>Leader</th>
            <th>Total WO</th>
            <th>Complete</th>
            <th>On Progress</th>
            <th>Completion Rate</th>
          </tr>
        </thead>
        <tbody id="wilayahBody">
          <tr><td colspan="8" style="text-align:center">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <div class="table-pager">
      <button id="wilayahPrev">Previous</button>
      <div class="page-numbers" id="wilayahPages">
        <button class="page-btn active">1</button>
      </div>
      <button id="wilayahNext">Next</button>
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<%- include('layout/footer') %>
